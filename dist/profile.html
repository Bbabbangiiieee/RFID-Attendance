<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
    <meta name="author" content="AdminKit">
    <meta name="keywords"
        content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="shortcut icon" href="../images/ustp_favicon.jpg" />

    <link rel="canonical" href="https://demo-basic.adminkit.io/pages-blank.html" />

    <title>USTP | User Profile</title>

    <link href="./assets/css/app.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <!--Scripts-->
    <script src="./assets/js/app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/Chart.min.js"></script>

</head>


<body>
    <div class="wrapper">
        <nav id="sidebar" class="sidebar js-sidebar">
            <div class="sidebar-content js-simplebar">
                <a class="sidebar-brand" href="dashboard.html">
                    <span class="align-middle">
                        <img class="avatar img-fluid rounded me-1" style="margin-right: 10px !important;"
                            src="../images/ustp_favicon.jpg"></img>USTP</span>
                </a>

                <ul class="sidebar-nav">
                    <li class="sidebar-header">
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="dashboard.html">
                            <i class="align-middle" data-feather="activity"></i> <span
                                class="align-middle">Dashboard</span>
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="attendance.html">
                            <i class="align-middle" data-feather="check-square"></i> <span
                                class="align-middle">Attendance</span>
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="schedule.html">
                            <i class="align-middle" data-feather="clock"></i> <span class="align-middle">Class
                                Schedule</span>
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="calendar.html">
                            <i class="align-middle" data-feather="calendar"></i> <span
                                class="align-middle">Calendar</span>
                        </a>
                    </li>

                    <li class="sidebar-item">
                        <a class="sidebar-link" href="help.html">
                            <i class="align-middle" data-feather="help-circle"></i> <span
                                class="align-middle">Help</span>
                        </a>
                </ul>
            </div>
        </nav>

        <div class="main">
            <nav class="navbar navbar-expand navbar-light navbar-bg">
                <a class="sidebar-toggle js-sidebar-toggle">
                    <i class="hamburger align-self-center"></i>
                </a>
                <h3 style="font-weight: bold; margin: auto;">UNIVERSITY OF SCIENCE AND TECHNOLOGY OF SOUTHERN
                    PHILIPPINES</h3 style="font-weight: bold; margin: auto;">


                <div class="navbar-collapse collapse">
                    <ul class="navbar-nav navbar-align">

                        <li class="nav-item dropdown">

                            <a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#"
                                data-bs-toggle="dropdown">

                                <i class="avatar img-fluid rounded me-1" data-feather="user"></i><span class="text-dark"
                                    id="user"></span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end">
                                <a class="dropdown-item" href="profile.html"><i class="align-middle me-1"
                                        data-feather="user"></i> Profile</a>
                                <a class="dropdown-item" href="schedule.html"><i class="align-middle me-1"
                                        data-feather="clock"></i>
                                    Schedule</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" id="logout">Log out</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
            <main class="content">
                <div class="container-fluid p-0">

                    <div class="mb-3">
                        <h1 class="h3 d-inline align-middle">Profile</h1>

                    </div>
                    <div class="row">
                        <div class="col-md-4 col-xl-3">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Profile Details</h5>
                                </div>
                                <div class="card-body text-center">
                                    <img src="./images/user.png" alt="user" class="img-fluid rounded-circle mb-2"
                                        width="128" height="128" />
                                    <h5 class="card-title mb-0" id="profile"></h5>
                                    <div class="text-muted mb-2" id="profLevel"></div>

                                </div>
                                <hr class="my-0" />
                                <div class="card-body classes-container">
                                    <h5 class="h6 card-title">Subjects</h5>
                                </div>
                                <hr class="my-0" />
                                <div class="card-body">
                                    <h5 class="h6 card-title">Faculty Data</h5>
                                    <ul class="list-unstyled mb-0">
                                        <li class="mb-1">Level: <a href="#" id="level"></a></li>
                                        <li class="mb-1">College: <a href="#" id="college"></a></li>
                                        <li class="mb-1">Department: <a href="#" id="department"></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-8 col-xl-9">
                            <div class="card">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">About</h5>
                                </div>
                                <div class="card-body h-100">
                                    <div class="mb-3">
                                        <label class="form-label">Address</label>
                                        <p class="form-control" id="address"></p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <p class="form-control" id="email"></p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Contact Number</label>
                                        <p class="form-control" id="mobileno"></p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Religion</label>
                                        <p class="form-control" id="religion"></p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Birthdate</label>
                                        <p class="form-control" id="birthdate"></p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Birthplace</label>
                                        <p class="form-control" id="birthplace"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <script type="module">

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, connectFirestoreEmulator, query, getDocs, getDoc, updateDoc, setDoc, doc, onSnapshot, deleteDoc, orderBy } from 'https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js';
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAvI3hLtCXY2wt2ub4-HSV6RuOsQLSxn24",
            authDomain: "attendance-73f9c.firebaseapp.com",
            projectId: "attendance-73f9c",
            storageBucket: "attendance-73f9c.appspot.com",
            messagingSenderId: "604516915514",
            appId: "1:604516915514:web:3d45ba93f938d45e5ed803",
            measurementId: "G-6J7XH07YNX"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);
        const auth = getAuth();
        console.log(app);
        let userId, userRef, classListRef, profileRef;

        document.addEventListener("DOMContentLoaded", function () {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in.
                    const userUid = user.uid;
                    console.log('User UID:', userUid);

                    // Now you can use the userUid in your queries
                    userId = userUid; // Use this userId in your collections
                    userRef = collection(db, "Attendance_Monitoring");
                    classListRef = collection(userRef, userId, "class_list");
                    profileRef = collection(db, "Attendance_Monitoring", userId, 'profile');

                    getDocs(profileRef).then((userRefSnapshot) => {

                        userRefSnapshot.forEach((userListDoc) => {
                            const userInfo = userListDoc.data();
                            const fname = userInfo.fname;
                            const lname = userInfo.lname;
                            const mname = userInfo.mname;
                            const address = userInfo.address;
                            const email = userInfo.email;
                            const mobileno = userInfo.mobileno;
                            const religion = userInfo.religion;
                            const birthdate = userInfo.birthdate;
                            const birthplace = userInfo.birthplace;
                            const level = userInfo.level;
                            const college = userInfo.college;
                            const department = userInfo.department;

                            document.getElementById("user").innerText = `${fname} ${lname}`;
                            document.getElementById("profile").innerText = `${fname} ${lname}`;
                            document.getElementById("profLevel").innerText = `${level}`;
                            document.getElementById("address").innerText = `${address}`;
                            document.getElementById("email").innerText = `${email}`;
                            document.getElementById("mobileno").innerText = `${mobileno}`;
                            document.getElementById("religion").innerText = `${religion}`;
                            document.getElementById("birthdate").innerText = `${birthdate}`;
                            document.getElementById("birthplace").innerText = `${birthplace}`;
                            document.getElementById("level").innerText = `${level}`;
                            document.getElementById("college").innerText = `${college}`;
                            document.getElementById("department").innerText = `${department}`;

                        });



                    }).catch((error) => {
                        console.error("Error getting document:", error);
                    });



                    getDocs(classListRef).then((classListRefSnapshot) => {
                        const classesContainer = document.querySelector(".classes-container");
                        let classSec;

                        classListRefSnapshot.forEach((classListDoc) => {
                            const classListData = classListDoc.data();

                            // Check if the class is not already in the array before adding it
                            if (classSec != classListData.class_name_sec) {
                                classSec = classListData.class_name_sec;
                                // Create a new element for each class and append it to the classes container
                                const classElement = document.createElement("a");
                                classElement.href = "#";
                                classElement.className = "badge bg-primary me-1 my-1 class";
                                classElement.innerText = classSec;

                                classesContainer.appendChild(classElement);
                            }

                        });
                    });
                }
            })
        });

        document.getElementById("logout").addEventListener("click", function () {
            signOut(auth).then(() => {
                // Sign-out successful.
                console.log('Sign-out successful.');
                alert('Sign-out successful.');
                window.location.href = "index.html";
            }).catch((error) => {
                // An error happened.
                console.log('An error happened.');
            });
        });

    </script>
</body>

</html>