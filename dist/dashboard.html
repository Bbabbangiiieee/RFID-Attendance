<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
	<meta name="author" content="AdminKit">
	<meta name="keywords"
		content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="../images/ustp_favicon.jpg" />
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.0/css/jquery.dataTables.min.css" />

	<link rel="canonical" href="https://demo-basic.adminkit.io/pages-blank.html" />

	<title>USTP | Dashboard</title>

	<link href="./assets/css/app.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
	<!--Scripts-->
	<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/Chart.min.js"></script>
	<script>
		// Initialize the current date
		const currentDate = new Date();

		// Function to display the current date in "dd/mm/yyyy" format with short month name
		function displayCurrentDate() {
			const container = document.getElementById("date-container");
			const day = currentDate.getDate();
			const month = currentDate.toLocaleString('default', { month: 'short' });
			const year = currentDate.getFullYear();


			container.textContent = `Date: ${day} ${month} ${year}`;
		}
	</script>
</head>

<body>
	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="dashboard.html">
					<span class="align-middle">
						<img class="avatar img-fluid rounded me-1" style="margin-right: 10px !important;"
							src="../images/ustp_favicon.jpg"></img>USTP</span>
				</a>

				<ul class="sidebar-nav">
					<li class="sidebar-header">
					</li>

					<li class="sidebar-item active">
						<a class="sidebar-link" href="dashboard.html">
							<i class="align-middle" data-feather="activity"></i> <span
								class="align-middle">Dashboard</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="attendance.html">
							<i class="align-middle" data-feather="check-square"></i> <span
								class="align-middle">Attendance</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="schedule.html">
							<i class="align-middle" data-feather="clock"></i> <span class="align-middle">Class
								Schedule</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="calendar.html">
							<i class="align-middle" data-feather="calendar"></i> <span
								class="align-middle">Calendar</span>
						</a>
					</li>

					<li class="sidebar-item">
						<a class="sidebar-link" href="help.html">
							<i class="align-middle" data-feather="help-circle"></i> <span
								class="align-middle">Help</span>
						</a>
				</ul>
			</div>
		</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
					<i class="hamburger align-self-center"></i>
				</a>
				<h3 style="font-weight: bold; margin: auto;">UNIVERSITY OF SCIENCE AND TECHNOLOGY OF SOUTHERN
					PHILIPPINES</h3 style="font-weight: bold; margin: auto;">


				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">

						<li class="nav-item dropdown">

							<a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#"
								data-bs-toggle="dropdown">

								<i class="avatar img-fluid rounded me-1" data-feather="user"></i><span class="text-dark"
									id="user"></span>
							</a>
							<div class="dropdown-menu dropdown-menu-end">
								<a class="dropdown-item" href="profile.html"><i class="align-middle me-1"
										data-feather="user"></i> Profile</a>
								<a class="dropdown-item" href="schedule.html"><i class="align-middle me-1"
										data-feather="clock"></i>
									Schedule</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="#" id="logout">Log out</a>
							</div>
						</li>
					</ul>
				</div>
			</nav>
			<main class="content">
				<div class="container-fluid p-0">

					<h1 class="h3 mb-3"><strong>Analytics</strong> Dashboard</h1>

					<div class="row">
						<div class="col-xl-6 col-xxl-5 d-flex">
							<div class="w-100">
								<div class="row">
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Classes</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="book"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3" id="totalClasses"></h1>
												<div class="mb-0">
													<span class="text-muted">Total number of classes this sem</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Present</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="award"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3" id="totalPresent"></h1>
												<div class="mb-0">
													<span class="text-muted">Total number of student presence in all
														subjects this month</span>
												</div>
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Students</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="users"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3" id="totalStudents"></h1>
												<div class="mb-0">
													<span class="text-muted">Total number of students this sem</span>
												</div>
											</div>
										</div>
										<div class="card">
											<div class="card-body">
												<div class="row">
													<div class="col mt-0">
														<h5 class="card-title">Absent</h5>
													</div>

													<div class="col-auto">
														<div class="stat text-primary">
															<i class="align-middle" data-feather="alert-triangle"></i>
														</div>
													</div>
												</div>
												<h1 class="mt-1 mb-3" id="totalAbsent"></h1>
												<div class="mb-0">
													<span class="text-muted">Total number of student absences in all
														subjects this month</span>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="col-xl-6 col-xxl-7">
							<div class="card flex-fill w-100">
								<div class="card-header">

									<h5 class="card-title mb-0 nav-link d-none d-sm-inline-block">This Month's
										Attendance</h5>
									<div class="nav-link d-none d-sm-inline-block" style="float: right !important;">
										<select class="btn btn-warning text-dark" style="padding: 6px !important;"
											id="myDropdown">
											<option value="" class=" dropdown-menu-end">Select Class</option>
											<option value="" class=" dropdown-menu-end">Select Class</option>
										</select>
									</div>
								</div>
								<div class="card-body py-3">
									<div class="chart chart-sm">
										<canvas id="attendanceChart"></canvas>
									</div>
								</div>
								<div class="card-body py-3">
									<p>
										The graphical representation illustrates the attendance patterns of <strong
											id="selClass"></strong> students during the school days of <strong
											id="month"></strong>. It reveals that the class had a presence of <strong
											id="present"></strong>, and total absence of <strong id="absent"></strong>.
										Moreover, as depicted,
										tardiness is at <strong id="late"></strong> and excuses are at <strong
											id="excuse"></strong>
									</p>
								</div>

							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-xl-6 col-xxl-5 d-flex">
							<div class="card flex-fill">
								<div class="card-header">

									<h5 class="card-title mb-0">Calendar</h5>
								</div>
								<div class="card-body d-flex">
									<div class="align-self-center w-100">
										<div class="chart">
											<div id="datetimepicker-dashboard"></div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="col-xl-6 col-xxl-7" style="height:100% !important;">
							<div class="card flex-fill w-100">
								<div class="card-header">

									<h5 class="card-title mb-0 nav-link d-none d-sm-inline-block">Today's Attendance
									</h5>
									<div class="nav-link d-none d-sm-inline-block" style="float: right !important;">
									</div>
								</div>
								<div class="card-body py-3">
									<div class="chart chart-sm">
										<canvas id="pieChart"></canvas>
									</div>
								</div>
								<div class="px-4">
									<p>
										The graphical representation illustrates the attendance patterns of <strong
											id="selClass2"></strong> today. It reveals that the class had a presence of
										<strong id="presentDay"></strong>, and total absence of <strong
											id="absentDay"></strong>.
										Moreover, as depicted,
										tardiness is at <strong id="lateDay"></strong> and excuses are at <strong
											id="excuseDay"></strong>
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>


		</div>
	</div>

	<script src="./assets/js/app.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>


</body>

</html>
<script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" charset="utf8"
	src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>

<script type="module">

	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
	import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-analytics.js";
	import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-auth.js";
	import { getFirestore, collection, addDoc, connectFirestoreEmulator, query, getDocs, getDoc, updateDoc, setDoc, doc, onSnapshot, deleteDoc, orderBy } from 'https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore.js';
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries

	// Your web app's Firebase configuration
	// For Firebase JS SDK v7.20.0 and later, measurementId is optional
	const firebaseConfig = {
		apiKey: "AIzaSyAlorTSQlN1-GfABuQgbUGQi5Fd3tg9T3E",
		authDomain: "test-de11b.firebaseapp.com",
		projectId: "test-de11b",
		storageBucket: "test-de11b.appspot.com",
		messagingSenderId: "731834875968",
		appId: "1:731834875968:web:939410069881f707c31fa5",
		measurementId: "G-6EDC6FST60"
	};

	// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	const db = getFirestore(app);
	const analytics = getAnalytics(app);
	const auth = getAuth();
	console.log(app);

	document.addEventListener('DOMContentLoaded', function () {
		// Assuming your dropdown has the ID "myDropdown"
		const dropdown = document.getElementById("myDropdown");
		const tableBody = document.getElementById('tableBody');
		let counter = 1;
		let i = 0;
		let selectedClass, studRefs = [], matchingStudIndex; // Variable to store the selected class
		let userId, userRef, stud_classRef, attendanceRef, classListRef, studListRef, profileRef;


		auth.onAuthStateChanged((user) => {
			if (user) {
				// User is signed in.
				const userUid = user.uid;
				console.log('User UID:', userUid);

				// Now you can use the userUid in your queries
				userId = userUid; // Use this userId in your collections
				userRef = collection(db, "Attendance_Monitoring");
				stud_classRef = collection(userRef, userId, "stud_class");
				attendanceRef = collection(userRef, userId, "attendance");
				classListRef = collection(userRef, userId, "class_list");
				studListRef = collection(userRef, userId, "student_list");
				profileRef = collection(db, "Attendance_Monitoring", userId, 'profile');

				getDocs(profileRef).then((userRefSnapshot) => {

					userRefSnapshot.forEach((userListDoc) => {
						const userInfo = userListDoc.data();
						const fname = userInfo.fname;
						const lname = userInfo.lname;
						const mname = userInfo.mname;

						document.getElementById("user").innerText = `${fname} ${lname}`;

					});



				}).catch((error) => {
					console.error("Error getting document:", error);
				});



				//FOR THE CARDS
				// Fetch student data
				getDocs(studListRef).then((studListRefSnapshot) => {

					// Array to store the options
					let studentsArray = [];

					studListRefSnapshot.forEach((studListDoc) => {
						const studListData = studListDoc.data()

						// Add each option to the array
						studentsArray.push(studListData);
					});

					const totalStudents = studentsArray.length;

					// Update the content of the h1 element
					document.getElementById("totalStudents").innerText = totalStudents;
				});

				//Attendance Card
				getDocs(attendanceRef).then((attendanceRefSnapshot) => {
					// Log the fetched data to the console for debugging
					console.log("Fetched data:", attendanceRefSnapshot);

					// Arrays to store the options
					let presentArray = [];
					let absentArray = [];

					// Get the current month and year
					const currentDate = new Date();
					const month = currentDate.toLocaleString('default', { month: 'long' });
					document.getElementById("month").innerText = month;
					const currentMonth = currentDate.getMonth() + 1; // Months are zero-based
					const currentYear = currentDate.getFullYear();


					attendanceRefSnapshot.forEach((attendanceListDoc) => {
						const attendanceData = attendanceListDoc.data();
						const attendanceStatus = attendanceData.status;
						const attendanceTimestamp = attendanceData.date_time.toDate();
						const attendanceMonth = attendanceTimestamp.getMonth() + 1;
						const attendanceYear = attendanceTimestamp.getFullYear();

						// Check if the attendance is for the current month
						if (attendanceStatus === "Present" && attendanceMonth === currentMonth && attendanceYear === currentYear) {
							presentArray.push(attendanceStatus);
						} else if (attendanceStatus === "Absent" && attendanceMonth === currentMonth && attendanceYear === currentYear) {
							absentArray.push(attendanceStatus);
						}
					});

					// Get the total count for present and absent
					const totalPresent = presentArray.length;
					const totalAbsent = absentArray.length;

					// Update the content of the h1 element
					document.getElementById("totalPresent").innerText = totalPresent;
					document.getElementById("totalAbsent").innerText = totalAbsent;
				});

				// Fetch data and populate options
				getDocs(classListRef).then((classListRefSnapshot) => {
					// Log the fetched data to the console for debugging
					console.log("Fetched data:", classListRefSnapshot);

					// Array to store the options
					let optionsArray = [];

					classListRefSnapshot.forEach((classListDoc) => {
						const classListData = classListDoc.data().class_name_sec;

						// Add each option to the array
						optionsArray.push(classListData);
					});

					const totalClasses = optionsArray.length;

					// Update the content of the h1 element
					document.getElementById("totalClasses").innerText = totalClasses;

					// Populate dropdown with options
					populateDropdown(optionsArray);
				});

				// Function to populate the dropdown with options
				function populateDropdown(options) {
					// Clear existing options
					dropdown.innerHTML = "";

					// Add new options
					options.forEach((option) => {
						const optionElement = document.createElement("option");
						optionElement.text = option;
						optionElement.value = option; // Set the value attribute
						optionElement.className = "option";
						dropdown.appendChild(optionElement);
					});

					// Print the value of the default option
					selectedClass = dropdown.value;

					// Add event listener to the dropdown
					dropdown.addEventListener("change", function () {
						selectedClass = this.value;
						handleValueChanged(selectedClass);
					});

					// Call the function to retrieve and display data based on the default selected class
					retrieveAndDisplayData(selectedClass);
				}

				// Function to handle the changed value
				function handleValueChanged(updatedValue) {
					selectedClass = updatedValue;

					// Call the function to retrieve and display data based on the selected class
					retrieveAndDisplayData(selectedClass);
				}
				// Initialize a flag to check if DataTable is already initialized
				let isDataTableInitialized = false;
				let myTable;

				function sortByStudentName(a, b) {
					const nameA = a.student.toUpperCase(); // Convert names to uppercase for case-insensitive sorting
					const nameB = b.student.toUpperCase();

					if (nameA < nameB) {
						return -1;
					}
					if (nameA > nameB) {
						return 1;
					}
					return 0;
				}

				// Function to retrieve and display data based on the selected class
				function retrieveAndDisplayData(selectedClass) {
					// Reset studRefs and counter for each call
					let studRefs = [];
					let counter = 1;
					let stud_names = []; // Declare an array to store stud_names and studRefs
					let stud_name; // Declare stud_name outside the loop
					let class_name_sec;
					const filteredPromises = [];
					const filteredAttendance = [];

					// Retrieve data from the stud_class collection based on the selectedClass
					getDocs(stud_classRef)
						.then((studClassSnapshot) => {
							const promises = [];

							studClassSnapshot.forEach((studClassDoc) => {
								const studClassData = studClassDoc.data();
								const studentRef = studClassData.student;
								const classRef = studClassData.class;

								// Use a closure to capture the value of stud_name and studRef for each iteration
								let studRef;

								const promise = Promise.all([getDoc(studentRef), getDoc(classRef)]).then(
									([studentDoc, classDoc]) => {
										if (
											studentDoc.exists &&
											classDoc.exists &&
											classDoc.data().class_name_sec === selectedClass
										) {
											stud_name = studentDoc.data().stud_name;
											const class_name_sec = classDoc.data().class_name_sec;
											studRef = studClassDoc.ref.path;
											studRefs.push(studRef);
											stud_names.push({ stud_name, studRef });
											console.log(stud_name, class_name_sec);

											// Add the promise to the filteredPromises array
											filteredPromises.push({ stud_name, class_name_sec, studRef });
										}
									}
								);

								promises.push(promise);
							});

							// Wait for all promises to resolve before moving to the next step
							return Promise.all(promises).then(() => filteredPromises);
						})
						.then((filteredPromises) => {
							// Now, process attendanceRef documents
							const nStudents = filteredPromises.length;
							//document.getElementById("nStudents").innerText = nStudents;
							document.getElementById("selClass").innerText = selectedClass;
							document.getElementById("selClass2").innerText = selectedClass;

							getDocs(attendanceRef).then((attendanceSnapshot) => {
								attendanceSnapshot.forEach((attendanceDoc) => {
									const attendanceData = attendanceDoc.data();
									const att_stud_class = attendanceData.student_class.path;
									const status = attendanceData.status;
									const date_time = attendanceData.date_time;
									console.log("Attendance Data:", att_stud_class, status, date_time);
									let studentAdded, existingIndex;



									for (const filteredPromise of filteredPromises) {
										const studRefer = filteredPromise.studRef;
										const student = filteredPromise.stud_name;
										const nonstat = "";
										const nondate = "";

										const existingIndex = filteredAttendance.findIndex(item => item.student === student);

										if (att_stud_class === studRefer) {
											filteredAttendance.push({
												student: student,
												att_stud_class: att_stud_class,
												status: status,
												date_time: date_time
											});

										}
										console.log("existingIndex:", existingIndex);
										console.log("filteredAttendance:", filteredAttendance);
									}

								});
								const filteredAttendanceData = filteredAttendance;
								return filteredAttendanceData;
							}).then((filteredAttendanceData) => {

								// Sort the filteredAttendanceData array by student name
								filteredAttendanceData.sort(sortByStudentName);
								const totalAttendanceCounts = {
									present: 0,
									absent: 0,
									late: 0,
									excuse: 0,
								};
								const totalAttendanceCountsDay = {
									present: 0,
									absent: 0,
									late: 0,
									excuse: 0,
								};

								for (const attendance of filteredAttendanceData) {

									const currentDate = new Date();
									const currentMonth = currentDate.getMonth() + 1; // Months are zero-based
									const currentYear = currentDate.getFullYear();

									const student_class = attendance.att_stud_class;
									const status = attendance.status;

									let attendanceTimestamp, attendanceMonth, attendanceYear;

									if (!attendance.date_time) {
										date_time = 0;
									} else {
										attendanceTimestamp = attendance.date_time.toDate();
										attendanceMonth = attendanceTimestamp.getMonth() + 1;
										attendanceYear = attendanceTimestamp.getFullYear();
									}

									if (studRefs.includes(student_class) &&
										attendanceMonth === currentMonth && attendanceYear === currentYear) {
										totalAttendanceCounts.present += status === 'Present' ? 1 : 0;
										totalAttendanceCounts.absent += status === 'Absent' ? 1 : 0;
										totalAttendanceCounts.late += status === 'Late' ? 1 : 0;
										totalAttendanceCounts.excuse += status === 'Excuse' ? 1 : 0;
									}
								}
								const totalEntries = totalAttendanceCounts.present + totalAttendanceCounts.absent + totalAttendanceCounts.late + totalAttendanceCounts.excuse;

								const percentagePresent = (totalAttendanceCounts.present / totalEntries) * 100;
								const percentageAbsent = (totalAttendanceCounts.absent / totalEntries) * 100;
								const percentageLate = (totalAttendanceCounts.late / totalEntries) * 100;
								const percentageExcuse = (totalAttendanceCounts.excuse / totalEntries) * 100;

								document.getElementById("present").innerText = `${totalAttendanceCounts.present} (${formatPercentage(percentagePresent)}%)`;
								document.getElementById("absent").innerText = `${totalAttendanceCounts.absent} (${formatPercentage(percentageAbsent)}%)`;
								document.getElementById("late").innerText = `${totalAttendanceCounts.late} (${formatPercentage(percentageLate)}%)`;
								document.getElementById("excuse").innerText = `${totalAttendanceCounts.excuse} (${formatPercentage(percentageExcuse)}%)`;

								// Prepare data for the bar graph
								const labels = Object.keys(totalAttendanceCounts);
								const data = labels.map(status => totalAttendanceCounts[status]);



								const ctx = document.getElementById('attendanceChart').getContext('2d');

								const chart = new Chart(ctx, {
									type: 'bar',
									data: {
										labels: labels,
										datasets: [
											{
												label: 'Total Occurrences',
												backgroundColor: ['green', 'red', 'orange', 'gray'], // Add more colors if needed
												data: data,
											},
										],
									},
									options: {
										scales: {
											xAxes: [{
												gridLines: {
													display: true
												}
											}],
											yAxes: [{
												gridLines: {
													display: false
												},
												ticks: {
													beginAtZero: true  // Set this property to true
												}
											}]
										},
										legend: {
											display: false
										}
									}
								});

								for (const attendance of filteredAttendanceData) {

									const currentDate = new Date();

									const student_class = attendance.att_stud_class;
									const status = attendance.status;

									let attendanceTimestamp, attendanceDate, attendanceMonth, attendanceYear;

									if (!attendance.date_time) {
										attendanceDate = 0;
									} else {
										attendanceTimestamp = attendance.date_time.toDate();
										attendanceDate = attendanceTimestamp.getDate();
										attendanceMonth = attendanceTimestamp.getMonth() + 1; // Months are zero-based
										attendanceYear = attendanceTimestamp.getFullYear();
									}

									if (studRefs.includes(student_class) &&
										attendanceDate === currentDate.getDate() &&
										attendanceMonth === currentDate.getMonth() + 1 && // Months are zero-based
										attendanceYear === currentDate.getFullYear()) {
										totalAttendanceCountsDay.present += status === 'Present' ? 1 : 0;
										totalAttendanceCountsDay.absent += status === 'Absent' ? 1 : 0;
										totalAttendanceCountsDay.late += status === 'Late' ? 1 : 0;
										totalAttendanceCountsDay.excuse += status === 'Excuse' ? 1 : 0;
									}
								}

								const totalEntriesDay = totalAttendanceCountsDay.present + totalAttendanceCountsDay.absent + totalAttendanceCountsDay.late + totalAttendanceCountsDay.excuse;

								const percentagePresentDay = (totalAttendanceCountsDay.present / totalEntriesDay) * 100;
								const percentageAbsentDay = (totalAttendanceCountsDay.absent / totalEntriesDay) * 100;
								const percentageLateDay = (totalAttendanceCountsDay.late / totalEntriesDay) * 100;
								const percentageExcuseDay = (totalAttendanceCountsDay.excuse / totalEntriesDay) * 100;

								document.getElementById("presentDay").innerText = `${totalAttendanceCountsDay.present} (${formatPercentage(percentagePresentDay)}%)`;
								document.getElementById("absentDay").innerText = `${totalAttendanceCountsDay.absent} (${formatPercentage(percentageAbsentDay)}%)`;
								document.getElementById("lateDay").innerText = `${totalAttendanceCountsDay.late} (${formatPercentage(percentageLateDay)}%)`;
								document.getElementById("excuseDay").innerText = `${totalAttendanceCountsDay.excuse} (${formatPercentage(percentageExcuseDay)}%)`;

								// Prepare data for the bar graph
								const dayLabels = Object.keys(totalAttendanceCountsDay);
								const dayData = labels.map(status => totalAttendanceCountsDay[status]);



								const ptx = document.getElementById('pieChart').getContext('2d');

								const pie = new Chart(ptx, {
									type: 'pie',
									data: {
										labels: dayLabels,
										datasets: [
											{
												backgroundColor: ['green', 'red', 'orange', 'gray'],
												data: dayData,
											},
										],
									},

								});


							})
						})

				}

				function formatPercentage(percentage) {
					// Check if percentage is NaN, if true, replace with 0
					return isNaN(percentage) ? '0.00' : percentage.toFixed(2);
				}

			} else {
				// User is signed out.
				console.log('User is signed out.');
				// You might want to redirect the user to the login page or show a login form.
			}
		});




	});


	document.getElementById('logout').style.display = 'block';
	//----- Logout code start	  
	document.getElementById("logout").addEventListener("click", function () {
		signOut(auth).then(() => {
			// Sign-out successful.
			console.log('Sign-out successful.');
			alert('Sign-out successful.');
			window.location.href = "index.html";
		}).catch((error) => {
			// An error happened.
			console.log('An error happened.');
		});
	});
	//----- End
</script>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		var date = new Date(Date.now() - 5 * 24 * 60 * 60 * 1000);
		var defaultDate = date.getUTCFullYear() + "-" + (date.getUTCMonth() + 1) + "-" + date.getUTCDate();
		document.getElementById("datetimepicker-dashboard").flatpickr({
			inline: true,
			prevArrow: "<span title=\"Previous month\">&laquo;</span>",
			nextArrow: "<span title=\"Next month\">&raquo;</span>",
			defaultDate: defaultDate
		});
	});
</script>